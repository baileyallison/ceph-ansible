---
- name: setup ceph repository on redhat family OS
  when: ansible_facts['os_family'] == 'RedHat'
  block:
    - name: configure red hat ceph community repository stable key
      rpm_key:
        key: "{{ ceph_stable_key }}"
        state: present
      register: result
      until: result is succeeded

    - name: configure red hat ceph stable community repository
      yum_repository:
        name: ceph_stable
        description: Ceph packages for $basearch
        gpgcheck: yes
        state: present
        gpgkey: "{{ ceph_stable_key }}"
        baseurl: "{{ ceph_mirror }}/rpm-{{ ceph_verison }}/el{{ ansible_facts['distribution_major_version'] }}/$basearch"
        file: ceph_stable
        priority: 1
      register: result
      until: result is succeeded

    - name: configure red hat ceph stable noarch community repository
      yum_repository:
        name: ceph_stable
        description: Ceph noarch packages
        gpgcheck: yes
        state: present
        gpgkey: "{{ ceph_stable_key }}"
        baseurl: "{{ ceph_mirror }}/rpm-{{ ceph_version }}/el{{ ansible_facts['distribution_major_version'] }}/noarch"
        file: ceph_stable
        priority: 1
      register: result
      until: result is succeeded